"use strict";(self["webpackChunkrx"]=self["webpackChunkrx"]||[]).push([[631],{631:function(t,a,s){s.r(a),s.d(a,{default:function(){return c}});var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"shopbag"},[a("van-nav-bar",{attrs:{title:"购物袋","left-text":"返回","right-text":"编辑","left-arrow":"",fixed:""},on:{"click-left":t.back}}),0==t.shopbagData.length?a("div",[a("van-empty",{attrs:{description:"购物袋空空如也，去逛一逛！"}},[a("van-button",{staticClass:"bottom-button",attrs:{round:""}},[t._v("逛一逛")])],1)],1):t._e(),a("div",{staticClass:"shopbag-box"},[0!==t.shopbagData.length?a("div",{staticClass:"shopbag-bg"}):t._e(),0!==t.shopbagData.length?a("van-list",{attrs:{finished:t.finished,"finished-text":"哎呀，没有数据可加载了",offset:"20"},on:{load:t.loadData},model:{value:t.loading,callback:function(a){t.loading=a},expression:"loading"}},[a("div",{staticClass:"shopbag-product"},t._l(t.shopbagData,(function(s,e){return a("div",{key:e,staticClass:"shopbag-item"},[a("div",{staticClass:"cell-item"},[a("van-swipe-cell",{scopedSlots:t._u([{key:"right",fn:function(){return[a("van-button",{attrs:{square:"",type:"danger",text:"删除"},on:{click:function(a){return t.removeOne(e,s.sid)}}})]},proxy:!0}],null,!0)},[a("div",{staticClass:"cell-item-box clearfix"},[a("div",{staticClass:"check-box fl"},[a("van-checkbox",{on:{change:t.simpSelect},model:{value:s.isChecked,callback:function(a){t.$set(s,"isChecked",a)},expression:"item.isChecked"}})],1),a("div",{staticClass:"pro-info-box fl"},[a("div",{staticClass:"pro-img fl"},[a("img",{staticClass:"auto_img",attrs:{src:s.small_img,alt:""}})]),a("div",{staticClass:"pro-info fl"},[a("div",{staticClass:"pro-info-text"},[a("div",{staticClass:"names clearfix"},[a("div",{staticClass:"pro-name fl"},[t._v(t._s(s.name))]),a("div",{staticClass:"pro-rule fl"},[t._v(t._s(s.rule))])]),a("div",{staticClass:"pro-enname"},[t._v(t._s(s.enname))])]),a("div",{staticClass:"pro-count-box"},[a("div",{staticClass:"pro-price fl"},[t._v("￥"+t._s(s.price))]),a("div",{staticClass:"step-box fl"},[a("van-stepper",{attrs:{theme:"round","button-size":"20","disable-input":""},on:{change:function(a){return t.changeCount(s)}},model:{value:s.count,callback:function(a){t.$set(s,"count",a)},expression:"item.count"}})],1)])])])])])],1)])})),0)]):t._e(),a("van-submit-bar",{attrs:{price:t.total,"button-text":"提交订单"},on:{submit:t.commit}},[a("van-checkbox",{on:{click:t.allSelect},model:{value:t.isAllchecked,callback:function(a){t.isAllchecked=a},expression:"isAllchecked"}},[t._v("全选")])],1)],1)],1)},i=[],o={name:"Shopbag",data(){return{shopbagData:[],allShopbagData:[],startIndex:0,dataCount:8,loading:!0,finished:!1,prices:280,isAllchecked:!1,count:2,isChecked:!1,total:0}},created(){this.getShopbagData()},methods:{back(){this.$router.go(-1)},getShopbagData(){let t=localStorage.getItem("__tk");if(!t)return this.$toast("请先登录"),this.$router.push({name:"Login"});this.axios({method:"GET",url:"/findAllShopcart",params:{appkey:this.appkey,tokenString:t}}).then((t=>{console.log(t),700==t.data.code?this.$router.push({name:"Login"}):5e3==t.data.code&&(t.data.result.map((t=>{t.isChecked=!1})),this.allShopbagData=t.data.result,this.shopbagData=this.allShopbagData.slice(this.startIndex,this.startIndex+this.dataCount),this.startIndex+=this.dataCount,this.loading=!1)}))},loadData(){setTimeout((()=>{let t=this.allShopbagData.slice(this.startIndex,this.startIndex+this.dataCount);this.startIndex+=this.dataCount,this.shopbagData.push(...t),this.isAllchecked=!1,t.length<this.dataCount?this.finished=!0:this.loading=!1}),1500)},allSelect(){this.shopbagData.map((t=>{t.isChecked=this.isAllchecked})),this.sum()},simpSelect(){this.sum();for(let t=0;t<this.shopbagData.length;t++)if(!this.shopbagData[t].isChecked)return void(this.isAllchecked=!1);this.isAllchecked=!0},sum(){this.total=0,this.shopbagData.map((t=>{t.isChecked&&(this.total+=t.price*t.count)})),this.total*=100},removeOne(t,a){console.log(t);let s=localStorage.getItem("__tk");if(!s)return this.$toast("请先登录"),this.$router.push({name:"Login"});this.axios({method:"POST",url:"/deleteShopcart",data:{appkey:this.appkey,tokenString:s,sids:JSON.stringify([a])}}).then((a=>{console.log(a),700==a.data.code?this.$router.push({name:"Login"}):7e3==a.data.code&&(this.shopbagData.splice(t,1),this.sum())}))},isSelectProduct(t){for(let a=0;a<this.shopbagData.length;a++)if(this.shopbagData[a].isChecked)return!0;return!1},changeCount(t){let a=localStorage.getItem("__tk");if(!a)return this.$toast("请先登录"),this.$router.push({name:"Login"});this.axios({method:"POST",url:"/modifyShopcartCount",data:{appkey:this.appkey,tokenString:a,sid:t.sid,count:t.count}}).then((a=>{700==a.data.code?this.$router.push({name:"Login"}):6e3==a.data.code&&t.isChecked&&this.sum()}))},commit(){let t=this.isSelectProduct();if(!t)return void this.$toast("请先选择购买的商品");let a=[];this.shopbagData.map((t=>{t.isChecked&&a.push(t.sid)})),this.$router.push({name:"Pay",query:{sids:a.join("-")}})}}},l=o,n=s(1001),h=(0,n.Z)(l,e,i,!1,null,"7d5e9df5",null),c=h.exports}}]);
//# sourceMappingURL=631.3e8a32ab.js.map